@model IEnumerable<SuaNhaMVC.Models.WebsiteContent>

@{
    ViewData["Title"] = "Quản Lý Nội Dung Website";
}

<style>
.content-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}
.content-card:hover {
    transform: translateY(-2px);
}
.content-type-badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 20px;
}
.content-preview {
    max-height: 100px;
    overflow: hidden;
    position: relative;
}
.content-preview::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 20px;
    background: linear-gradient(transparent, white);
}
</style>

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-edit me-2"></i>Quản Lý Nội Dung Website</h1>
                    <p class="text-muted mb-0">Chỉnh sửa và cập nhật nội dung hiển thị trên website</p>
                </div>
                <div>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addContentModal">
                        <i class="fas fa-plus me-1"></i>Thêm Nội Dung Mới
                    </button>
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-1"></i>Quay Lại
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Types Filter -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card content-card">
                <div class="card-body">
                    <h5 class="card-title mb-3"><i class="fas fa-filter me-2"></i>Lọc Theo Loại Nội Dung</h5>
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check" name="contentFilter" id="all" autocomplete="off" checked>
                        <label class="btn btn-outline-primary" for="all">Tất Cả</label>

                        <input type="radio" class="btn-check" name="contentFilter" id="hero" autocomplete="off">
                        <label class="btn btn-outline-primary" for="hero">Hero Banner</label>

                        <input type="radio" class="btn-check" name="contentFilter" id="aboutus" autocomplete="off">
                        <label class="btn btn-outline-primary" for="aboutus">Giới Thiệu</label>

                        <input type="radio" class="btn-check" name="contentFilter" id="service" autocomplete="off">
                        <label class="btn btn-outline-primary" for="service">Dịch Vụ</label>

                        <input type="radio" class="btn-check" name="contentFilter" id="testimonial" autocomplete="off">
                        <label class="btn btn-outline-primary" for="testimonial">Đánh Giá</label>

                        <input type="radio" class="btn-check" name="contentFilter" id="contact" autocomplete="off">
                        <label class="btn btn-outline-primary" for="contact">Liên Hệ</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content List -->
    <div class="row">
        @if (!Model.Any())
        {
            <div class="col-12">
                <div class="card content-card text-center py-5">
                    <div class="card-body">
                        <i class="fas fa-file-alt fa-4x text-muted mb-3"></i>
                        <h4>Chưa có nội dung nào</h4>
                        <p class="text-muted">Hãy thêm nội dung đầu tiên cho website của bạn</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addContentModal">
                            <i class="fas fa-plus me-1"></i>Thêm Nội Dung
                        </button>
                    </div>
                </div>
            </div>
        }
        else
        {
            @foreach (var content in Model)
            {
                <div class="col-md-6 col-lg-4 mb-4 content-item" data-type="@content.Type.ToString().ToLower()">
                    <div class="card content-card h-100">
                        @if (!string.IsNullOrEmpty(content.ImageUrl))
                        {
                            <img src="@content.ImageUrl" class="card-img-top" style="height: 200px; object-fit: cover;" alt="@content.Title">
                        }
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">@content.Title</h5>
                                <span class="badge @GetTypeColor(content.Type) content-type-badge">@GetTypeText(content.Type)</span>
                            </div>
                            
                            <p class="text-muted small mb-2">Key: @content.Key</p>
                            
                            @if (!string.IsNullOrEmpty(content.Content))
                            {
                                <div class="content-preview mb-3">
                                    <p class="card-text">@content.Content</p>
                                </div>
                            }
                            
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">Thứ tự: @content.Order</small>
                                    <span class="badge @(content.IsActive ? "bg-success" : "bg-secondary")">
                                        @(content.IsActive ? "Đang hiển thị" : "Ẩn")
                                    </span>
                                </div>
                                
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-primary btn-sm" onclick="editContent('@content.Id')">
                                        <i class="fas fa-edit"></i> Sửa
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="deleteContent('@content.Id', '@content.Title')">
                                        <i class="fas fa-trash"></i> Xóa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>

<!-- Add Content Modal -->
<div class="modal fade" id="addContentModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form asp-action="CreateContent" method="post">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus me-2"></i>Thêm Nội Dung Mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Key (Mã định danh)</label>
                                <input type="text" class="form-control" name="key" required>
                                <div class="form-text">Ví dụ: hero-title, about-description</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Loại Nội Dung</label>
                                <select class="form-select" name="type" required>
                                    <option value="Hero">Hero Banner</option>
                                    <option value="AboutUs">Giới Thiệu</option>
                                    <option value="Service">Dịch Vụ</option>
                                    <option value="Testimonial">Đánh Giá</option>
                                    <option value="Contact">Liên Hệ</option>
                                    <option value="Footer">Footer</option>
                                    <option value="Feature">Tính Năng</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Tiêu Đề</label>
                        <input type="text" class="form-control" name="title" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Nội Dung</label>
                        <textarea class="form-control" name="content" rows="4"></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">URL Hình Ảnh</label>
                                <input type="url" class="form-control" name="imageUrl">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Link</label>
                                <input type="url" class="form-control" name="link">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Thứ Tự Hiển Thị</label>
                        <input type="number" class="form-control" name="order" value="0" min="0">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">Thêm Nội Dung</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Filter content by type
document.querySelectorAll('input[name="contentFilter"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const filterType = this.id;
        const contentItems = document.querySelectorAll('.content-item');
        
        contentItems.forEach(item => {
            if (filterType === 'all' || item.dataset.type === filterType) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    });
});

function editContent(id) {
    // Implementation for edit content
    alert('Chức năng sửa nội dung sẽ được triển khai');
}

function deleteContent(id, title) {
    if (confirm(`Bạn có chắc chắn muốn xóa nội dung "${title}"?`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '@Url.Action("DeleteContent")';
        
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'id';
        input.value = id;
        
        form.appendChild(input);
        document.body.appendChild(form);
        form.submit();
    }
}
</script>

@functions {
    private string GetTypeColor(ContentType type)
    {
        return type switch
        {
            ContentType.Hero => "bg-primary",
            ContentType.AboutUs => "bg-info",
            ContentType.Service => "bg-success",
            ContentType.Testimonial => "bg-warning",
            ContentType.Contact => "bg-danger",
            ContentType.Footer => "bg-dark",
            ContentType.Feature => "bg-secondary",
            _ => "bg-secondary"
        };
    }
    
    private string GetTypeText(ContentType type)
    {
        return type switch
        {
            ContentType.Hero => "Hero",
            ContentType.AboutUs => "Giới Thiệu",
            ContentType.Service => "Dịch Vụ",
            ContentType.Testimonial => "Đánh Giá",
            ContentType.Contact => "Liên Hệ",
            ContentType.Footer => "Footer",
            ContentType.Feature => "Tính Năng",
            _ => type.ToString()
        };
    }
}